<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#09090b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TASKER PRO</title>
    
    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600;800&display=swap');
        
        :root { --bg: #09090b; --card: #18181b; --primary: #3b82f6; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #e2e8f0; -webkit-tap-highlight-color: transparent; }
        .font-display { font-family: 'Space Grotesk', sans-serif; }

        /* Smooth Animations */
        .glass { background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .card-glass { background: rgba(39, 39, 42, 0.4); border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(4px); }
        
        /* Status Lights & Animations */
        @keyframes blinkRed { 0%, 100% { opacity: 1; box-shadow: 0 0 10px var(--danger); } 50% { opacity: 0.4; box-shadow: none; } }
        @keyframes pulseGreen { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        @keyframes fireFlicker { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
        
        .status-light { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .light-red { background: var(--danger); animation: blinkRed 1s infinite; }
        .light-green { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .light-yellow { background: #eab308; opacity: 0.5; }
        .light-fire { font-size: 14px; animation: fireFlicker 0.5s infinite alternate; filter: drop-shadow(0 0 5px orange); }

        /* Custom Scrollbar */
        .hide-scroll::-webkit-scrollbar { display: none; }

        /* Task Check Animation */
        .check-anim { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .task-done { opacity: 0.5; text-decoration: line-through; }

        /* Graph Container */
        .chart-container { position: relative; height: 200px; width: 100%; }
        
        .safe-top { padding-top: max(env(safe-area-inset-top), 20px); }
    </style>
</head>
<body class="pb-28 safe-top">

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass pt-2 transition-all duration-300" id="header">
        <div class="max-w-3xl mx-auto px-4 pb-2">
            <div class="flex justify-between items-center mb-4 pt-2">
                <div>
                    <h1 class="text-2xl font-bold font-display tracking-tight text-white flex items-center gap-2">
                        TASKER<span class="text-blue-500">.PRO</span>
                    </h1>
                    <p class="text-[10px] text-slate-400 font-mono tracking-widest uppercase" id="current-date-display">SYNCING...</p>
                </div>
                <button onclick="toggleStats()" class="bg-blue-600/20 text-blue-400 p-2 rounded-xl border border-blue-500/30 hover:bg-blue-600 hover:text-white transition-all">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 002 2h2a2 2 0 002-2z" /></svg>
                </button>
            </div>

            <!-- Day Navigation -->
            <div class="flex gap-3 overflow-x-auto pb-2 hide-scroll" id="dayTabs"></div>
        </div>
    </header>

    <div class="h-40"></div>

    <!-- Stats Modal (Hidden by default) -->
    <div id="stats-panel" class="hidden fixed inset-0 z-[60] bg-black/90 backdrop-blur-md p-6 flex-col justify-center anim-fade">
        <div class="max-w-3xl mx-auto w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold font-display text-white">Performance Analytics</h2>
                <button onclick="toggleStats()" class="text-slate-400 text-2xl">‚úï</button>
            </div>
            
            <!-- Graph -->
            <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800 mb-6">
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Insights -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <div class="text-slate-400 text-xs uppercase font-bold">Total Tasks</div>
                    <div class="text-2xl font-bold text-white mt-1" id="stat-total">0</div>
                </div>
                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <div class="text-slate-400 text-xs uppercase font-bold">Completion Rate</div>
                    <div class="text-2xl font-bold text-blue-400 mt-1" id="stat-rate">0%</div>
                </div>
            </div>
            
            <div class="mt-6 text-center">
                <p id="motivation-text" class="text-sm font-mono text-yellow-400 italic">"Calculating your destiny..."</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-4 space-y-6" id="app"></main>

    <script>
        // --- üéµ Sound Engine (Premium) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            gain.connect(audioCtx.destination); osc.connect(gain);
            
            const now = audioCtx.currentTime;
            if (type === 'check') {
                osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(); osc.stop(now + 0.2);
            } else if (type === 'add') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(300, now);
                gain.gain.setValueAtTime(0.05, now); gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            }
        }

        // --- üíæ Data & Logic ---
        const START_DAY_NUM = 4; // 4th of the month
        const MONTH_NAME = "FEB"; // Just for display
        
        let appData = JSON.parse(localStorage.getItem('tasker_pro_v1'));

        // Initialize empty data if new
        if (!appData) {
            const coreTasks = ["DC Generator", "DC Motor", "Alternator", "1-Phase Motor", "3-Phase Induction"];
            appData = {
                days: Array.from({ length: 7 }, (_, i) => ({
                    date: START_DAY_NUM + i,
                    slots: [
                        { title: 'Morning Core (Fixed)', time: '04-07 AM', color: 'blue', tasks: coreTasks.map(t => ({ id: Date.now()+Math.random(), text: t, done: false })) },
                        { title: 'GK & Non-Tech', time: '09-02 PM', color: 'orange', tasks: [] }, // Empty
                        { title: 'Theory Deep Dive', time: '02-07 PM', color: 'green', tasks: [] }, // Empty
                        { title: 'Night Review', time: '08-10 PM', color: 'purple', tasks: [] } // Empty
                    ]
                }))
            };
            save();
        }

        function save() {
            localStorage.setItem('tasker_pro_v1', JSON.stringify(appData));
            updateUI();
        }

        // --- üóìÔ∏è Date & State Tracking ---
        let currentViewDayIndex = 0;
        
        function detectRealDate() {
            const today = new Date();
            const dateNum = today.getDate();
            
            // Display Date
            const dateOptions = { weekday: 'long', month: 'short', day: 'numeric' };
            document.getElementById('current-date-display').innerText = today.toLocaleDateString('en-US', dateOptions);

            // Find which day of the challenge is today
            const index = dateNum - START_DAY_NUM;
            if (index >= 0 && index < 7) {
                currentViewDayIndex = index;
            } else {
                currentViewDayIndex = 0; // Default to start if out of range
            }
            updateUI();
        }

        // --- üìä Analytics Logic ---
        let chartInstance = null;

        function getDayStats(dayIndex) {
            const day = appData.days[dayIndex];
            const allTasks = day.slots.flatMap(s => s.tasks);
            if (allTasks.length === 0) return { pct: 0, status: 'empty' };
            
            const done = allTasks.filter(t => t.done).length;
            const pct = Math.round((done / allTasks.length) * 100);
            
            let status = 'neutral';
            if (pct >= 95) status = 'fire';
            else if (pct >= 80) status = 'good';
            else if (pct < 80 && pct > 0) status = 'bad';
            
            return { pct, status, done, total: allTasks.length };
        }

        function toggleStats() {
            const modal = document.getElementById('stats-panel');
            const isHidden = modal.classList.contains('hidden');
            
            if (isHidden) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                renderChart();
            } else {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }

        function renderChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const dataPoints = appData.days.map((_, i) => getDayStats(i).pct);
            const labels = appData.days.map(d => `${d.date}th`);
            
            // Calculate Aggregates
            const totalTasks = appData.days.flatMap(d => d.slots.flatMap(s => s.tasks)).length;
            const totalDone = appData.days.flatMap(d => d.slots.flatMap(s => s.tasks)).filter(t => t.done).length;
            const globalRate = totalTasks ? Math.round((totalDone/totalTasks)*100) : 0;

            document.getElementById('stat-total').innerText = totalDone + " / " + totalTasks;
            document.getElementById('stat-rate').innerText = globalRate + "%";
            
            // Motivation Logic
            const quoteEl = document.getElementById('motivation-text');
            if (globalRate > 90) quoteEl.innerText = "üî• UNSTOPPABLE! You are crushing it!";
            else if (globalRate > 75) quoteEl.innerText = "üí™ Solid Progress. Keep pushing!";
            else quoteEl.innerText = "‚ö†Ô∏è Focus Needed. Don't break the chain!";

            if (chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion %',
                        data: dataPoints,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4, // Smooth curves
                        fill: true,
                        pointBackgroundColor: '#10b981',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: '#334155' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- ‚ö° UI Rendering ---
        function updateUI() {
            const dayContainer = document.getElementById('dayTabs');
            const appContainer = document.getElementById('app');
            const currentDayData = appData.days[currentViewDayIndex];

            // 1. Render Day Tabs (with Lights)
            dayContainer.innerHTML = appData.days.map((d, i) => {
                const isActive = i === currentViewDayIndex;
                const stats = getDayStats(i);
                
                // Status Light Logic
                let indicator = '';
                if (stats.status === 'fire') indicator = `<div class="absolute -top-1 -right-1">üî•</div>`;
                else if (stats.status === 'bad') indicator = `<div class="absolute top-1 right-1 status-light light-red"></div>`;
                else if (stats.status === 'good') indicator = `<div class="absolute top-1 right-1 status-light light-green"></div>`;
                else indicator = `<div class="absolute top-1 right-1 status-light light-yellow"></div>`;

                return `
                    <button onclick="currentViewDayIndex=${i}; updateUI();" 
                        class="relative flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 ${isActive ? 'bg-slate-800 border-2 border-blue-500 shadow-lg shadow-blue-900/50 scale-105' : 'bg-slate-900 border border-slate-800 opacity-70'}">
                        ${indicator}
                        <span class="text-[10px] font-bold text-slate-500 uppercase">Day</span>
                        <span class="text-2xl font-display font-bold ${isActive ? 'text-white' : 'text-slate-400'}">${d.date}</span>
                        <div class="mt-1 w-8 h-1 bg-slate-700 rounded-full overflow-hidden">
                            <div class="h-full ${stats.pct < 50 ? 'bg-red-500' : 'bg-green-500'}" style="width: ${stats.pct}%"></div>
                        </div>
                    </button>
                `;
            }).join('');

            // 2. Render Main Tasks
            // Header Progress
            const dayStats = getDayStats(currentViewDayIndex);
            let html = `
                <div class="mb-8 p-1">
                    <div class="flex justify-between items-end mb-2">
                        <h2 class="text-xl font-bold text-white">Today's Targets</h2>
                        <div class="text-3xl font-display font-bold ${dayStats.pct < 80 ? 'text-red-400' : 'text-green-400'}">${dayStats.pct}%</div>
                    </div>
                    <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div class="h-full transition-all duration-500 ${dayStats.pct < 80 ? 'bg-red-500' : (dayStats.pct >= 95 ? 'bg-gradient-to-r from-orange-400 to-red-500' : 'bg-green-500')}" style="width: ${dayStats.pct}%"></div>
                    </div>
                    ${dayStats.pct < 80 && dayStats.total > 0 ? '<div class="text-xs text-red-400 mt-2 text-center animate-pulse">‚ö†Ô∏è Performance is below 80%. Push harder!</div>' : ''}
                </div>
            `;

            // Slots
            html += currentDayData.slots.map((slot, sIdx) => {
                const theme = {
                    blue: 'border-l-blue-500', 
                    orange: 'border-l-orange-500', 
                    green: 'border-l-green-500', 
                    purple: 'border-l-purple-500' 
                }[slot.color];

                return `
                <div class="mb-5 bg-slate-900/50 backdrop-blur-sm border-l-4 ${theme} rounded-r-xl border-y border-r border-slate-800/50 overflow-hidden">
                    <div class="p-4 bg-slate-800/30 flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-slate-200 text-lg">${slot.title}</h3>
                            <span class="text-xs font-mono text-slate-500">${slot.time}</span>
                        </div>
                    </div>
                    
                    <div class="p-4 space-y-3">
                        ${slot.tasks.map(t => `
                            <div class="flex items-start gap-3 group">
                                <button onclick="toggleTask(${sIdx}, ${t.id})" 
                                    class="mt-0.5 w-6 h-6 rounded-md border-2 border-slate-600 flex items-center justify-center transition-all check-anim ${t.done ? 'bg-green-500 border-green-500' : 'hover:border-blue-500'}">
                                    ${t.done ? '‚úì' : ''}
                                </button>
                                <div class="flex-1 transition-all ${t.done ? 'task-done' : ''}">
                                    <p class="text-sm font-medium text-slate-200">${t.text}</p>
                                </div>
                                <button onclick="deleteTask(${sIdx}, ${t.id})" class="text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">‚úï</button>
                            </div>
                        `).join('')}
                    </div>

                    <div class="px-4 pb-4">
                        <div class="flex items-center gap-2 bg-slate-950/50 rounded-lg border border-slate-800 focus-within:border-blue-500/50 transition-colors p-1">
                            <span class="pl-2 text-slate-500 text-lg">+</span>
                            <input type="text" id="in-${sIdx}" 
                                placeholder="Add new task..." 
                                class="bg-transparent border-none outline-none text-sm text-white w-full h-8"
                                onkeydown="if(event.key==='Enter') addTask(${sIdx})">
                            <button onclick="addTask(${sIdx})" class="bg-slate-800 hover:bg-slate-700 text-xs text-white px-3 py-1.5 rounded-md font-bold transition-colors">ADD</button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');

            appContainer.innerHTML = html;
        }

        // --- Actions ---
        function toggleTask(slotIdx, taskId) {
            const slot = appData.days[currentViewDayIndex].slots[slotIdx];
            const task = slot.tasks.find(t => t.id === taskId);
            task.done = !task.done;
            if (task.done) playSfx('check');
            save();
        }

        function addTask(slotIdx) {
            const input = document.getElementById(`in-${slotIdx}`);
            const text = input.value.trim();
            if (text) {
                appData.days[currentViewDayIndex].slots[slotIdx].tasks.push({
                    id: Date.now(),
                    text: text,
                    done: false
                });
                playSfx('add');
                input.value = '';
                save();
                // Keep focus
                setTimeout(() => document.getElementById(`in-${slotIdx}`).focus(), 10);
            }
        }

        function deleteTask(slotIdx, taskId) {
            if(confirm("Delete this task?")) {
                const slot = appData.days[currentViewDayIndex].slots[slotIdx];
                slot.tasks = slot.tasks.filter(t => t.id !== taskId);
  
